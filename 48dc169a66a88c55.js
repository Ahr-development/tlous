import"./style.css";import*as THREE from"three";import{OrbitControls}from"three/examples/jsm/controls/OrbitControls.js";import{Water}from"three/examples/jsm/objects/Water.js";import{Sky}from"three/examples/jsm/objects/Sky.js";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader";let container,camera,scene,renderer,controls,water,sun,mesh;const clock=new THREE.Clock;let previousTime=0,mixer=null;init(),animate();const sizes={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))})),window.addEventListener("dblclick",(()=>{document.fullscreenElement||document.webkitFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitexitFullscreen&&document.webkitexitFullscreen():container.requestFullscreen?container.requestFullscreen():container.webkitRequestFullscreen&&container.webkitRequestFullscreen()}));const listener=new THREE.AudioListener;camera.add(listener);const sound=new THREE.Audio(listener),audioLoader=new THREE.AudioLoader;function init(){container=document.getElementById("container"),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.toneMapping=THREE.ACESFilmicToneMapping,container.appendChild(renderer.domElement),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,1,2e4),camera.position.set(0,0,0),(new GLTFLoader).load("../boat.gltf",(e=>{e.scene.position.set(0,0,-300),e.scene.rotation.set(0,-80,0),scene.add(e.scene),e.scene.scale.set(.5,.5,.5),camera.lookAt(e.scene),controls.update(),console.log(e),mixer=new THREE.AnimationMixer(e.scene);const n=mixer.clipAction(e.animations[0]),t=mixer.clipAction(e.animations[1]);n.play(),t.play()})),sun=new THREE.Vector3;const e=new THREE.PlaneGeometry(1e4,1e4);water=new Water(e,{textureWidth:512,textureHeight:512,waterNormals:(new THREE.TextureLoader).load("../waternormals.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping})),sunDirection:new THREE.Vector3,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==scene.fog}),water.rotation.x=-Math.PI/2,scene.add(water);const n=new Sky;n.scale.setScalar(1e4),scene.add(n);const t=n.material.uniforms;t.turbidity.value=10,t.rayleigh.value=2,t.mieCoefficient.value=.005,t.mieDirectionalG.value=.8;const i=new THREE.PMREMGenerator(renderer);let r;!function(){const e=THREE.MathUtils.degToRad(90),t=THREE.MathUtils.degToRad(34);sun.setFromSphericalCoords(1,e,t),n.material.uniforms.sunPosition.value.copy(sun),water.material.uniforms.sunDirection.value.copy(sun).normalize(),void 0!==r&&r.dispose(),r=i.fromScene(n),scene.environment=r.texture}(),controls=new OrbitControls(camera,renderer.domElement),controls.maxPolarAngle=.495*Math.PI,controls.target.set(-40.8227909005808,55.15401928847851,-184.71750352826567),controls.minDistance=40,controls.maxDistance=200,controls.update(),window.addEventListener("resize",onWindowResize)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){const e=clock.getElapsedTime(),n=e-previousTime;previousTime=e,requestAnimationFrame(animate),render(),mixer&&mixer.update(n)}function render(){performance.now(),water.material.uniforms.time.value+=1/60,renderer.render(scene,camera)}audioLoader.load("../ocean.mp3",(function(e){sound.setBuffer(e),sound.setLoop(!0),sound.setVolume(1),sound.play()}));